<template>
<div class="page page-cart" id="pageId_${pageId}" data-name="cart">
    <div class="navbar ">
        <div class="navbar-bg"></div>
        <div class="navbar-inner">
            <div class="left  no-margin-right">
                <a href="#" class="link icon-only panel-open " data-panel="left">
                    <i class="icon f7-icons size-22">bars</i>
                </a>
            </div>
            <div class="title text-align-center">
                <div class="logo-small">
                    <img src="img/logo.png" alt="" class="img" />
                    <!-- <h6>GO<br /><small>MobileUX</small></h6> -->
                </div>
            </div>
            <div class="right text-align-center">
                <a href="/notificationlist/" class="link">
                    <i class="icon f7-icons size-22">bell_fill</i>
                </a>
            </div>
        </div>
    </div>


    <!-- main page content -->
    <div class="page-content has-footer">

        <!-- wizard links -->
        <div class="block">
            <div class="row justify-content-between wizard-wrapper margin-bottom-half elevation-2 ">
                <div class="col-33">
                    <a href="/cart/" class="wizard-link active">
                        <i class="icons f7-icons elevation-2">bag</i>
                        <span class="wizard-text">${type}</span>
                    </a>
                </div>
                <div class="col-33">
                    <a href="#" class="wizard-link">
                        <i class="icons f7-icons elevation-2">placemark</i>
                        <span class="wizard-text">Address</span>
                    </a>
                </div>
                <div class="col-33">
                    <a href="#" class="wizard-link">
                        <i class="icons f7-icons elevation-2">creditcard</i>
                        <span class="wizard-text">Payment</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- cart items -->
        <div class="block">
            <div class="row margin-bottom-half">
                <div class="col align-self-center">
                    <h5 class="no-margin-bottom">
                        <p>${cartCount} ${type} in cart</p>
                    </h5>
                </div>
                <div class="col-auto pe-0 align-self-center">
                    <a href="/home/" class="link text-color-theme">Shop more <i class="icons f7-icons">chevron_right</i></a>
                </div>
            </div>
        </div>

        <!-- <div class="block">
            <div class="row margin-bottom-half">
                <div class="col-100 medium-50 large-33">
                    <div class="card elevation-2 product margin-bottom-half">
                        <div class="card-content card-content-padding">
                            <div class="row">
                                <div class="col-auto">
                                    <figure class="text-align-center avatar-90 avatar">
                                        <img src="img/product1.png" alt="">
                                    </figure>
                                </div>
                                <div class="col no-padding-left">
                                    <p class="no-margin-bottom">
                                        <small class="text-opac">Fresh</small>
                                        <small class="float-right"><i class="icons f7-icons text-color-yellow">star</i>
                                            <span class="text-opac">4.0 (165 Reviews)</span></small>
                                    </p>
                                    <h6 class="text-color-theme margin-bottom-half">Apple</h6>
                                    <div class="row">
                                        <div class="col">
                                            <p class="no-margin-bottom">$12.00<br><small class="text-opac">per 1 kg</small></p>
                                        </div>
                                        <div class="col-auto">
                                            <div class="counter-number">
                                                <button class="btn btn-sm avatar avatar-30 no-padding rounded-circle">
                                                    <i class="icons f7-icons">minus</i>
                                                </button>
                                                <span>1</span>
                                                <button class="btn btn-sm avatar avatar-30 no-padding rounded-circle">
                                                    <i class="icons f7-icons">plus</i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-100 medium-50 large-33">
                    <div class="card elevation-2 product margin-bottom-half">
                        <div class="card-content card-content-padding">
                            <div class="row">
                                <div class="col-auto">
                                    <figure class="text-align-center avatar-90 avatar">
                                        <img src="img/product2.png" alt="">
                                    </figure>
                                </div>
                                <div class="col no-padding-left">
                                    <p class="no-margin-bottom">
                                        <small class="text-opac">Protein</small>
                                        <small class="float-right"><i class="icons f7-icons text-color-yellow">star</i>
                                            <span class="text-opac">4.0 (165 Reviews)</span></small>
                                    </p>
                                    <h6 class="text-color-theme margin-bottom-half">Banana</h6>
                                    <div class="row">
                                        <div class="col">
                                            <p class="no-margin-bottom">$12.00<br><small class="text-opac">per 1 kg</small></p>
                                        </div>
                                        <div class="col-auto">
                                            <div class="counter-number">
                                                <button class="btn btn-sm avatar avatar-30 no-padding rounded-circle">
                                                    <i class="icons f7-icons">minus</i>
                                                </button>
                                                <span>1</span>
                                                <button class="btn btn-sm avatar avatar-30 no-padding rounded-circle">
                                                    <i class="icons f7-icons">plus</i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-100 medium-50 large-33">
                    <div class="card elevation-2 product margin-bottom-half">
                        <div class="card-content card-content-padding">
                            <div class="row">
                                <div class="col-auto">
                                    <figure class="text-align-center avatar-90 avatar">
                                        <img src="img/product3.png" alt="">
                                    </figure>
                                </div>
                                <div class="col no-padding-left">
                                    <p class="no-margin-bottom">
                                        <small class="text-opac">Healthy</small>
                                        <small class="float-right"><i class="icons f7-icons text-color-yellow">star</i>
                                            <span class="text-opac">4.0 (165 Reviews)</span></small>
                                    </p>
                                    <h6 class="text-color-theme margin-bottom-half">Watermelon</h6>
                                    <div class="row">
                                        <div class="col">
                                            <p class="no-margin-bottom">$12.00<br><small class="text-opac">per 1 kg</small></p>
                                        </div>
                                        <div class="col-auto">
                                            <div class="counter-number">
                                                <button class="btn btn-sm avatar avatar-30 no-padding rounded-circle">
                                                    <i class="icons f7-icons">minus</i>
                                                </button>
                                                <span>1</span>
                                                <button class="btn btn-sm avatar avatar-30 no-padding rounded-circle">
                                                    <i class="icons f7-icons">plus</i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div> -->

        ${cartCount > 0 && $h`
 
        <!-- step 1 items modify -->
        <div class="block cartItemBlock">
            <div class="row margin-bottom-half">

                ${cartList.map((item) => $h`

                    <div class="col-100 medium-50 large-33">
                        <div class="card elevation-2 product margin-bottom-half">
                            <div class="card-content padding-half">
                                <div class="row">
                                    <div class="col-auto">
                                        <div class="text-center avatar-70 avatar">
                                            <img src="${item.image}" alt="" />
                                        </div>
                                    </div>
                                    <div class="col no-padding-left align-self-center">
                                        <div class="row">
                                            <div class="col">
                                                <div class="text-color-theme ">
                                                    ${item.name}</div>
                                                <p class="no-margin-bottom">
                                                    <small class="text-opac">Quantity : ${item.quantity}</small>
                                                </p>
                                            </div>
                                            <div class="col-auto text-align-right">
                                                <div class="col-auto " @click="${()=>removeCurrentProduct(item.pid)}">
                                                    <div class="btn btn-link text-color-theme">
                                                        <i class="icons f7-icons">trash</i>
                                                    </div>
                                                </div>
                                                <div class="col-auto ">
                                                    <p class="no-margin-bottom">
                                                        <small class="text-opac" style="text-decoration: line-through;">₹ ${item.mrp}</small>
                                                        <br/>
                                                        ₹ ${item.price}
                                                    </p>   
                                                </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                `)}
               
            </div>
        </div>

        <!-- step 2 shiping address set -->
        <!-- <div class="block shiping_addredd">
            <div class="block">
                <div class="row margin-bottom-half">
                    <div class="col align-self-center">
                        <h5 class="no-margin-bottom">Delivery location</h5>
                    </div>
                    <div class="col-auto pe-0 align-self-center">
                        <a href="/addresses/" class="link text-color-theme">Change <i class="icons f7-icons">chevron_right</i></a>
                    </div>
                </div>
            </div>
            <div class="block">
                <div class="row">
                    <div class="col-100 medium-50 large-33 mx-auto">
                        <div class="card elevation-2 product margin-bottom">
                            <div class="card-header">
                                <div class="row">
                                    <div class="col align-self-center">
                                        <h5 class="no-margin-bottom">Capsulepluse<br>
                                            <span class="text-opac small">Primary</span>
                                        </h5>
                                    </div>
                                    <div class="col-auto align-self-center no-padding">
                                        <a href="/addresses/" class="button button-link text-color-theme"><i class="icons f7-icons">pencil_outline</i></a>
                                    </div>
                                    <div class="col-auto align-self-center">
                                        <a href="/addaddress/" class="button button-link text-color-theme"><i class="icons f7-icons">plus</i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="card-content card-content-padding">
                                <img src="img/map.png" alt="" class="mw-100 margin-bottom-half">
                                <div class="row">
                                    <div class="col">
                                        B 32, maker street 4, Beside Train Tower, Algobbaalsa,<br>California- 25468 (US)
                                    </div>
                                    <div class="col-auto text-align-right">
                                        <i class="icons f7-icons text-color-theme">arrow_up_right_circle</i><br>
                                        <small class="text-opac">2.5km <i class="icons f7-icons">placemark</i></small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div> -->
        


        <!-- step 3 payment      -->
        
         <!-- <div class="block">
            <div class="row margin-bottom-half">
                <div class="col align-self-center">
                    <h5 class="no-margin-bottom">Coupon Code</h5>
                </div>
                <div class="col-auto pe-0 align-self-center">
                    <a href="/home/" class="link text-color-theme">Offers <i class="icons f7-icons">chevron_right</i></a>
                </div>
            </div>
        </div>
        <div class="block">
            <div class="row margin-bottom-half">
                <div class="col">
                    <div class="list form-list no-margin">
                        <ul>
                            <li class="item-content item-input">
                                <div class="item-inner">
                                    <div class="item-title item-floating-label">Coupon Code</div>
                                    <div class="item-input-wrap">
                                        <input type="text" name="couponcode" value="FREEDEL100" />
                                        <span class="input-clear-button"></span>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="alert alert-green margin-bottom " role="alert">
                <div class="row">
                    <div class="col-auto align-self-center">
                        <i class="icon f7-icons text-color-green size-32">checkmark_alt_circle</i>
                    </div>
                    <div class="col no-padding-left">
                        <h6 class="text-color-green margin-bottom-half">Congratulations!</h6>
                        <p class="text-opac small">You have successfully applied "FREEDEL100" free delivery
                            coupon and updated price total amount as per below</p>
                    </div>
                </div>
            </div>
        </div> -->

       
        <!-- <div class="block">
            <div class="row margin-bottom-half">
                <div class="col align-self-center">
                    <h5 class="no-margin-bottom">Payment Modes</h5>
                </div>
            </div>
        </div> -->

        <!-- <div class="block">
            <div class="row margin-bottom">
                <div class="col-100 medium-50 large-33">
                    <a href="#" class="card elevation-2 display-block margin-bottom-half product text-normal">
                        <div class="card-content card-content-padding">
                            <div class="row">
                                <div class="col-auto">
                                    <figure class="text-center no-margin-bottom avatar avatar-40 page-bg rounded p-1">
                                        <img src="img/maestro.png" alt="">
                                    </figure>
                                </div>
                                <div class="col align-self-center">
                                    <p>Maestro card<br><small class="text-opac">**** **** **** 5689</small></p>
                                </div>
                                <div class="col-auto align-self-center">
                                    <i class="icons f7-icons text-color-theme">chevron_right</i>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="col-100 medium-50 large-33">
                    <a href="#" class="card elevation-2 display-block margin-bottom-half product text-normal">
                        <div class="card-content card-content-padding">
                            <div class="row">
                                <div class="col-auto">
                                    <figure class="text-center no-margin-bottom avatar avatar-40 page-bg rounded p-1">
                                        <img src="img/visa.png" alt="">
                                    </figure>
                                </div>
                                <div class="col align-self-center">
                                    <p>Maestro card<br><small class="text-opac">Add your card</small></p>
                                </div>
                                <div class="col-auto align-self-center">
                                    <i class="icons f7-icons text-color-theme">chevron_right</i>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="col-100 medium-50 large-33">
                    <a href="#" class="card elevation-2 display-block margin-bottom-half product text-normal">
                        <div class="card-content card-content-padding">
                            <div class="row">
                                <div class="col-auto">
                                    <figure class="text-center no-margin-bottom avatar avatar-40 page-bg rounded p-1">
                                        <img src="img/americanexp.png" alt="">
                                    </figure>
                                </div>
                                <div class="col align-self-center">
                                    <p>Maestro card<br><small class="text-opac">Apply for card</small></p>
                                </div>
                                <div class="col-auto align-self-center">
                                    <i class="icons f7-icons text-color-theme">chevron_right</i>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div> -->




        <!-- pricing -->
        <div class="block">
            <div class="row margin-bottom-half">
                <div class="col align-self-center">
                    <h5 class="no-margin-bottom"><p>Pricing</p></h5>
                </div>
            </div>
            <div class="row margin-bottom-half">
                <div class="col">
                    ${type == 'Lab test' && $h`
                    <p>Sample Collection Charge</p>
                    `}
                    ${type != 'Lab test' && $h`
                    <p>Shipping Cost</p>
                    `}
                </div>
                <div class="col-auto">
                    ${shippingCost == 0 && $h`
                        Free
                    `}
                    ${shippingCost > 0 && $h`
                        ₹ ${shippingCost}
                    `}    
                   
                </div>
            </div>

            <div class="row margin-bottom-half">
                <div class="col">
                    <p>Subtotal</p>
                </div>
                <div class="col-auto">₹ ${subtotal}</div>
            </div>

            <div class="row font-weight-bold margin-bottom">
                <div class="margin-bottom-half col-100">
                    <div class="dashed-line"></div>
                </div>
                <div class="col">
                    <p>Total</p>
                </div>
                <div class="col-auto">₹ ${total}</div>
            </div>
        </div>

        <!-- Button -->
        <div class="block">
            <div class="row margin-bottom">
                <div class="col align-self-center">
                    <a href="/address/" class="button button-large button-fill elevation-3 color-green">Next</a>
                </div>
            </div>
        </div>

        `}

    </div>

    <!-- footer static -->
    <footer class="footer">
        <div class="container">
            <ul>
                <li>
                    <a href="/home/">
                        <span>
                            <i class="icon f7-icons">house</i>
                            <span class="nav-text">Home</span>
                        </span>
                    </a>
                </li>
                <li>
                    <a  href="/nearByLabList/">
                        <span>
                            <i class="icon f7-icons">eyedropper_halffull</i>
                            <span class="nav-text">Lab</span>
                        </span>
                    </a>
                </li>
                <li class="active center-item">
                    <a href="/cart/">
                        <span>
                            <i class="icon f7-icons">cart</i>
                            <span class="nav-text">card-content</span>
                            <!-- <span class="countercart">${app.params.totalCartItems()}</span> -->
                        </span>
                    </a>
                </li>
                <li>
                    <a href="/profile/">
                        <span>
                            <i class="icon f7-icons">person</i>
                            <span class="nav-text">Profile</span>
                        </span>
                    </a>
                </li>
                <li>
                    <a href="/contactus/">
                        <span>
                            <i class="icon f7-icons">question_circle</i>
                            <span class="nav-text">Help</span>
                        </span>
                    </a>
                </li>
            </ul>
        </div>
    </footer>

</div>
</template>

<script>
    export default (props, { $f7, $theme, $on, $update, $ }) => {
      var app = $f7;
      let cartList = [] ;

        let totalQuantity =  0;
        let total = 0;
        let subtotal = 0;
        // let cartCount = app.params.cartCount();
        let cartCount = 0;
        let shippingCost = 0;
        const pageId = app.params.uuid();
        let type="Medicine";
      
        let removeCurrentProduct = (pid)=>{
            $f7.preloader.show();
             //=======remove cart items from server =======
            app.params.callToServer( "remove-cart", {'pid':pid} ,
            function success(Responce){
                $f7.preloader.hide();
                updateCurrentCart(Responce);
                // categoryName = Responce.data.category;
            });
        }

        const updateCurrentCart = (Responce)=>{
                cartList = Responce.data.cartContent ;
                totalQuantity = Responce.data.totalQuantity;
                total = Responce.data.total;
                subtotal = Responce.data.subtotal;
                cartCount = Responce.data.cartCount;
                shippingCost =  Responce.data.shippingCost;
                type = Responce.data.type;
                $update();
        }

        $on('pageInit', () => {
            $f7.preloader.show();
            app.params.callToServer( "cart",'',success);
            function success(Responce){
                $f7.preloader.hide();
                updateCurrentCart(Responce);
                
            }


        });
  
      return $render;
    }
  </script>