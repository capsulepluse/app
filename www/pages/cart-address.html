<template>
    <div class="page page-cart-address" id="pageId_${pageId}" data-name="cart-address">
        <div class="navbar ">
            <div class="navbar-bg"></div>
            <div class="navbar-inner">
                <div class="left  no-margin-right">
                    <a href="#" class="link icon-only panel-open " data-panel="left">
                        <i class="icon f7-icons size-22">bars</i>
                    </a>
                </div>
                <div class="title text-align-center">
                    <div class="logo-small">
                        <img src="img/logo.png" alt="" class="img" />
                        <!-- <h6>GO<br /><small>MobileUX</small></h6> -->
                    </div>
                </div>
                <div class="right text-align-center">
                    <a href="/notificationlist/" class="link">
                        <i class="icon f7-icons size-22">bell_fill</i>
                    </a>
                </div>
            </div>
        </div>


        <!-- main page content -->
        <div class="page-content has-footer top-compact">

            <form class="form-store-data cart-address-form" id="pageId_${pageId}cart-address-form">
                <!-- wizard links -->
                <div class="block">
                    <div class="row justify-content-between wizard-wrapper margin-bottom-half elevation-2">
                        <div class="col-33">
                            <a href="/cart/" class="wizard-link filled">
                                <i class="icons f7-icons elevation-2">bag</i>
                                <span class="wizard-text">${type}</span>
                            </a>
                        </div>
                        <div class="col-33">
                            <a href="/address/" class="wizard-link active">
                                <i class="icons f7-icons elevation-2">placemark</i>
                                <span class="wizard-text">Address</span>
                            </a>
                        </div>
                        <div class="col-33">
                            <a href="#" class="wizard-link">
                                <i class="icons f7-icons elevation-2">creditcard</i>
                                <span class="wizard-text">Payment</span>
                            </a>
                        </div>
                    </div>
                </div>
                

                ${typeCode == 'labtest' && $h`

                        <!-- oreder note  -->

                        <!-- general details  -->
                        <div class="block margin-bottom-half ">
                            <div class="row margin-bottom-half">
                                <div class="col">
                                    <h5 class="no-margin-bottom">
                                        <p>Order Note</p>
                                    </h5>
                                </div>
                            </div>
                            <div class="row margin-bottom-half">
                                <div class="col">

                                    <div class="card  elevation-2 font-12" >
                                        <div class="list form-list ">
                                            <ul class="">
                                                <li class="">
                                                    <a class="item smart-select smart-select-init" data-open-in="popup" data-close-on-select="true">

                                                        <div class="item-content item-input">
                                                            <div class="item-inner">
                                                                <div class="item-title item-label item-floating-label_">Select Patient</div>
                                                                <div class="item-input-wrap ">
                                                                    <!-- <input type="text" name="time" value="" /> -->
                                                                    <select name="patient" required validate>
                                                                        ${patientList.map((item) => $h`
                                                                        <option value="${item.id}">${item.name} - ${item.gender} - ${item.age}y</option>
                                                                        `)}
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </a>
                                                </li>
                                                <li class="item-content item-input">
                                                    <div class="item-inner">
                                                        <!-- "item-floating-label" class on item title -->
                                                        <div class="item-title item-label text-color-primary">Doctor Name</div>
                                                        <div class="item-input-wrap ">
                                                            <input class="no-padding-top" type="text" name="doctor" value="" placeholder="Please enter Doctor name" validate required />
                                                            <span class="input-clear-button"></span>
                                                        </div>
                                                    </div>
                                                </li>
                                                <li class="item-content item-input">
                                                    <div class="item-inner">
                                                        <!-- "item-floating-label" class on item title -->
                                                        <div class="item-title item-label text-color-primary ">Sample Collection Date</div>
                                                        <div class="item-input-wrap">
                                                            <input id="calendar-modal"  placeholder="Please enter Date as dd/mm/yyyy"
                                                                   type="text" name="date" value="" class="no-padding-top" required validate />
                                                            <span class="input-clear-button"></span>
                                                        </div>
                                                    </div>
                                                </li>

                                                <li class="">
                                                    <a class="item smart-select smart-select-init" data-open-in="popup" data-close-on-select="true">

                                                        <div class="item-content item-input">
                                                            <div class="item-inner">
                                                                <div class="item-title item-label">Select Time Slot
                                                                </div>
                                                                <div class="item-input-wrap">
                                                                    <!-- <input type="text" name="time" value="" /> -->
                                                                    <select name="slot">
                                                                        ${timeSchedule.map((item) => $h`
                                                                        <option value="${item}">${item}</option>
                                                                        `)}
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </a>
                                                </li>
                                                
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                       

                        <!-- Prescription upload  -->
                        <div class="block ">
                            <div class="row margin-bottom-half">
                                <div class="col">
                                    <h5 class="no-margin-bottom">
                                        <p>Upload Prescription </p>
                                    </h5>
                                </div>
                            </div>
                            <input type="hidden" value="" id="prescriptionIdList" name="prescription_id" />
                            <div class="row margin-bottom-half">
                                <div class="col">

                                    <div class="card elevation-2">
                                        <div class="row card-light justify-content-between wizard-wrapper margin-bottom-half elevation-2 padding-bottom-half padding-top-half ">
                                            <div class="col-33">
                                                <div class="wizard-link " @click="${() => openCamera()}">
                                                    <span class="icon f7-icons size-50 color-theme">camera</span>
                                                    <span class="wizard-text text-color-theme">Camera</span>
                                                </div>
                                            </div>
                                            <div class="col-33">
                                                <div  class="wizard-link " @click="${() => openSaveImage()}">
                                                    <span class="icon f7-icons size-50 color-theme">arrow_down_to_line_alt</span>
                                                    <span  class="wizard-text text-color-theme">Saved</span>
                                                </div>
                                            </div>
                                            <div class="col-33">
                                                <div  class="wizard-link" @click="${() => openGallery()}">
                                                    <span class="icon f7-icons size-50 color-theme">photo_fill_on_rectangle_fill</span>
                                                    <span  class="wizard-text text-color-theme">gallery</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row " id="selected_prescription_container">
            
                                        </div>


                                    </div>
                                </div>
                            </div>

                        </div>

                        <!-- sample collection note  -->
                        <div class="block ">
                            <div class="row margin-bottom-half">
                                <div class="col">
                                    <h5 class="no-margin-bottom">
                                        <p>Sample Collection Note</p>
                                    </h5>
                                </div>
                            </div>
                            <div class="row margin-bottom-half">
                                <div class="col">

                                    <div class="card elevation-2">
                                        <div class="list md font-13">
                                            <ul>
                                                <li>
                                                    <label class="item-radio item-radio-icon-start item-content">
                                                        <input type="radio" name="collection_type" value="centre" checked />
                                                        <i class="icon icon-radio text-color-theme"></i>
                                                        <div class="item-inner">
                                                            <div class="">Sample collection at centre</div>
                                                        </div>
                                                    </label>
                                                </li>
                                                <li>
                                                    <label class="item-radio item-radio-icon-start item-content">
                                                        <input type="radio" name="collection_type" value="home" />
                                                        <i class="icon icon-radio text-color-theme"></i>
                                                        <div class="item-inner">
                                                            <div class="">Home sample collection request
                                                            </div>
                                                        </div>
                                                    </label>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                         <div id="labAddressSelectBlock" style="display: none;">

                            <!-- cart items -->
                            <div class="block">
                                <div class="row margin-bottom-half">
                                    <div class="col align-self-center">
                                        <h5 class="no-margin-bottom">

                                    
                                            <p>Sample Collection Location</p>
                                            
                                           

                                        </h5>
                                    </div>
                                    <div class="col-auto pe-0 align-self-center">
                                        <a href="/addresses/" class="link text-color-theme font-12">Change <i
                                                class="icons f7-icons">chevron_right</i></a>
                                    </div>
                                </div>
                            </div>

                            <div class="block">
                                <div class="row">
                                    <div class="col-100 medium-50">
                                        <div class="card elevation-2 product margin-bottom-half">
                                            <div class="card-header">
                                                <!-- for default address  -->
                                                <div class="row">
                                                    <div class="col-auto align-self-center md">
                                                    </div>
                                                    <div class="col align-self-center no-padding-left">
                                                        <span class="text-opac small">${item.type}</span>
                                                    </div>
                                                    <div class="col-auto align-self-center">
                                                        <a href="/editaddress/${item.id}/"
                                                            class="btn btn-link text-color-theme"><i
                                                                class="icons f7-icons">square_pencil</i>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="card-content card-content-padding">
                                                <div class="row">
                                                    <div class="col font-12">
                                                        <div class="addressHeader font-13">
                                                            Name -  ${item.name}
                                                        </div>
                                                        <div >
                                                            Address - ${item.address}, 
                                                        </div>
                                                        <div>Landmark - ${item.landmark}</div>
                                                        <div>Pin -  ${item.pin}</div>
                                                        <div>Mobile - ${item.mobile}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                `}


                ${typeCode == 'medicine' && $h`

                    <!-- general details  -->
                    <div class="block margin-bottom-half ">
                        <div class="row margin-bottom-half">
                            <div class="col">
                                <h5 class="no-margin-bottom">
                                    <p>Order Note</p>
                                </h5>
                            </div>
                        </div>
                        <div class="row margin-bottom-half">
                            <div class="col">

                                <div class="card elevation-2">
                                    <div class="list form-list ">
                                        <ul class="">
                                            <li class="">
                                                <a class="item smart-select smart-select-init" data-open-in="popup" data-close-on-select="true">

                                                    <div class="item-content item-input">
                                                        <div class="item-inner">
                                                            <div class="item-title item-label item-floating-label_">Select Patient</div>
                                                            <div class="item-input-wrap ">
                                                                <!-- <input type="text" name="time" value="" /> -->
                                                                <select name="patient">
                                                                    ${patientList.map((item) => $h`
                                                                    <option value="${item.id}">${item.name} - ${item.gender} - ${item.age}y</option>
                                                                    `)}
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </a>
                                            </li>
                                            <li class="item-content item-input">
                                                <div class="item-inner">
                                                    <!-- "item-floating-label" class on item title -->
                                                    <div class="item-title item-label text-color-primary">Doctor Name</div>
                                                    <div class="item-input-wrap ">
                                                        <input class="no-padding-top" type="text" name="doctor" value="" placeholder="Please enter Doctor name" validate required />
                                                        <span class="input-clear-button"></span>
                                                    </div>
                                                </div>
                                            </li>
                                        
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                     <!-- Prescription upload  -->
                     <div class="block ">
                        <div class="row margin-bottom-half">
                            <div class="col">
                                <h5 class="no-margin-bottom">
                                    <p>Upload Prescription </p>
                                </h5>
                            </div>
                        </div>
                        <input type="hidden" value="" id="prescriptionIdList" name="prescription_id" />
                        <div class="row margin-bottom-half">
                            <div class="col">

                                <div class="card elevation-2">
                                    <div class="row card-light justify-content-between wizard-wrapper margin-bottom-half elevation-2 padding-bottom-half padding-top-half ">
                                        <div class="col-33">
                                            <div class="wizard-link " @click="${() => openCamera()}">
                                                <span class="icon f7-icons size-50 color-theme">camera</span>
                                                <span class="wizard-text text-color-theme">Camera</span>
                                            </div>
                                        </div>
                                        <div class="col-33">
                                            <div  class="wizard-link " @click="${() => openSaveImage()}">
                                                <span class="icon f7-icons size-50 color-theme">arrow_down_to_line_alt</span>
                                                <span  class="wizard-text text-color-theme">Saved</span>
                                            </div>
                                        </div>
                                        <div class="col-33">
                                            <div  class="wizard-link" @click="${() => openGallery()}">
                                                <span class="icon f7-icons size-50 color-theme">photo_fill_on_rectangle_fill</span>
                                                <span  class="wizard-text text-color-theme">gallery</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row " id="selected_prescription_container">
          
                                    </div>


                                </div>
                            </div>
                        </div>

                    </div>


                    <!-- delivery address -->
                    <div class="block">
                        <div class="row margin-bottom-half">
                            <div class="col align-self-center">
                                <h5 class="no-margin-bottom">
                                    <p>Delivery location</p>
                                </h5>
                            </div>
                            <div class="col-auto pe-0 align-self-center">
                                <a href="/addresses/" class="link text-color-theme font-12">Change <i
                                        class="icons f7-icons">chevron_right</i></a>
                            </div>
                        </div>
                    </div>

                    <div class="block">
                        <div class="row">
                            <div class="col-100 medium-50">
                                <div class="card elevation-2 product margin-bottom-half">
                                    <div class="card-header">
                                        <!-- for default address  -->
                                        <div class="row">
                                            <div class="col-auto align-self-center md">
                                            </div>
                                            <div class="col align-self-center no-padding-left">
                                                <span class="text-opac small">${item.type}</span>
                                            </div>
                                            <div class="col-auto align-self-center">
                                                <a href="/editaddress/${item.id}/"
                                                    class="btn btn-link text-color-theme"><i
                                                        class="icons f7-icons">square_pencil</i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-content card-content-padding">
                                        <div class="row">
                                            <div class="col font-12">
                                                <div class="addressHeader font-13">
                                                    Name -  ${item.name}
                                                </div>
                                                <div >
                                                    Address - ${item.address}, 
                                                </div>
                                                <div>Landmark - ${item.landmark}</div>
                                                <div>Pin -  ${item.pin}</div>
                                                <div>Mobile - ${item.mobile}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                `}


                ${typeCode == 'product' && $h`

                <!-- cart items -->
                <div class="block">
                    <div class="row margin-bottom-half">
                        <div class="col align-self-center">
                            <h5 class="no-margin-bottom">

                                <p>Delivery location</p>
                            </h5>
                        </div>
                        <div class="col-auto pe-0 align-self-center">
                            <a href="/addresses/" class="link text-color-theme font-12">Change <i
                                    class="icons f7-icons">chevron_right</i></a>
                        </div>
                    </div>
                </div>

                <div class="block">
                    <div class="row">


                        <div class="col-100 medium-50">
                            <div class="card elevation-2 product margin-bottom-half">
                                <div class="card-header">
                                    <!-- for default address  -->

                                    <div class="row">
                                        <div class="col-auto align-self-center md">
                                            <!-- <label class="item-radio item-radio-icon-start item-content">
                                            <input type="radio" name="defaultAddress" value="${item.id}" checked />
                                            <i class="icon icon-radio"></i>
                                        </label>   -->

                                        </div>
                                        <div class="col align-self-center no-padding-left">
                                           
                                                <span class="text-opac small">${item.type}</span>
                                        </div>
                                        <div class="col-auto align-self-center">
                                            <a href="/editaddress/${item.id}/" class="btn btn-link text-color-theme"><i
                                                    class="icons f7-icons">square_pencil</i></a>
                                            <!-- <a href="#" class="btn btn-link text-color-theme"><i class="icons f7-icons">trash</i></a> -->
                                        </div>
                                    </div>

                                </div>
                                <div class="card-content card-content-padding">
                                    <!-- <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d53231.962811927515!2d-117.15726395005734!3d33.5014375970648!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x80db6252f51abe23%3A0x68bc0e88a03806a8!2sTemecula%2C%20CA%2C%20USA!5e0!3m2!1sen!2sin!4v1623665123540!5m2!1sen!2sin"
                                class="h-190 width-100 rounded shadow-sm margin-bottom-half" allowfullscreen="" loading="lazy">
                            </iframe> -->
                                    <div class="row">
                                        <div class="col font-12">
                                            <div class="addressHeader font-13">
                                                Name -  ${item.name}
                                             </div>
                                             <div >
                                                Address - ${item.address}, 
                                             </div>
                                             <div>Landmark - ${item.landmark}</div>
                                             <div>Pin -  ${item.pin}</div>
                                             <div>Mobile - ${item.mobile}</div>

                                        </div>
                                        <!-- <div class="col-auto align-self-center">
                                            <a href="#"><i
                                                    class="icons f7-icons text-color-theme float-right">arrow_up_right_circle</i></a>
                                        </div> -->
                                    </div>
                                </div>
                            </div>


                        </div>



                    </div>
                </div>

                `}



                <!-- pricing -->
                <!-- <div class="block">
                <div class="row margin-bottom-half">
                    <div class="col align-self-center">
                        <h5 class="no-margin-bottom">Pricing</h5>
                    </div>
                </div>
                <div class="row margin-bottom-half">
                    <div class="col">
                        ${type == 'Lab test' && $h`
                        <p>Sample Collection Charge</p>
                        `}
                        ${type != 'Lab test' && $h`
                        <p>Shipping Cost</p>
                        `}
                    </div>
                    <div class="col-auto">
                        ${shippingCost == 0 && $h`
                        Free
                        `}
                        ${shippingCost > 0 && $h`
                        ₹ ${shippingCost}
                        `}

                    </div>
                </div>

                <div class="row margin-bottom-half">
                    <div class="col">
                        <p>Subtotal</p>
                    </div>
                    <div class="col-auto">₹ ${subtotal}</div>
                </div>

                <div class="row font-weight-bold margin-bottom">
                    <div class="margin-bottom-half col-100">
                        <div class="dashed-line"></div>
                    </div>
                    <div class="col">
                        <p>Total</p>
                    </div>
                    <div class="col-auto">₹ ${total}</div>
                </div>
                </div> -->
                ${cartCount > 0 && $h`
                <!-- Button -->
                <div class="block">
                    <div class="row margin-bottom">
                        <div class="col align-self-center">
                            <!-- <a href="/payment/" class="button button-large button-fill elevation-3 color-green">Next</a> -->
                            <button 
                                class="button button-large button-fill elevation-3 color-theme">Next</button>
                        </div>
                    </div>
                </div>
                `}
               
            </form>



             <!-- add product popup-->
         <div class="popup saveImageList">
            <div class="view">
              <div class="page">
                <div class="navbar">
                  <div class="navbar-bg"></div>
                  <div class="navbar-inner">
                    <div class="left">
                      <a class="link popup-close"><i class="icons f7-icons">arrow_left</i></a>
                    </div>
                    <div class="title">Save Prescription</div>
                    <div class="right">
                      <!-- Link to close popup -->
                      <a class="link popup-close"><i class="icons f7-icons">multiply</i></a>
                    </div>
                  </div>
                </div>
                <div class="page-content">
  
                  <div class="block" >
  
                  ${savePrescription.map((item) => $h`
  
                    <div class="row">
                      <div class="col-100 medium-50 large-33">
                        <div class="card elevation-2 margin-bottom-half">
                            <div class="card-content card-content-padding">
                                <div class="row">
                                    <div class="col-100">
                                        <figure class="text-align-center margin-bottom-half  page-bg rounded h-150">
                                            <img src="${item.thumbnail}" alt=""  />
                                        </figure>
                                    </div>
                                    <div class="col">
                                        <p class="small display-block">
                                            <span class="float-end">
                                              <span class="text-opac">${item.created_at}</span> 
                                              <i class="bi bi-clock"></i>
                                            </span>
                                        </p>
                                        <button class="button button-fill button-small button-raised"
                                        @click="${() => selectPrescription(item.thumbnail,item.id)}"
                                        >
                                            Select Prescription
                                        </button>
                                        <!-- <input type="button" data-id="${item.id}" data-thumbnail="{item.thumbnail}" class="selectPrescriptionCheck" value="Select Prescription" />
                                        <label class="checkbox margin-right-half">
                                         
                                          <i class="icon-checkbox"></i>
                                        </label> -->
                                         
                                    </div>
                                </div>
                            </div>
                        </div>
                      </div>
                    </div> 
  
                  `)}    
                    
                  </div>
  
                  
                 
  
                </div>
              </div>
            </div>
          </div>





        </div>

        <!-- footer static -->
    <footer class="footer">
        <div class="container">
            <ul>
                <li>
                    <a href="/home/">
                        <span>
                            <i class="icon f7-icons">house</i>
                            <span class="nav-text">Home</span>
                        </span>
                    </a>
                </li>
                <li>
                    <a  href="/nearByLabList/">
                        <span>
                            <i class="icon f7-icons">eyedropper_halffull</i>
                            <span class="nav-text">Lab</span>
                        </span>
                    </a>
                </li>
                <li class="active center-item">
                    <a href="/cart/">
                        <span>
                            <i class="icon f7-icons">cart</i>
                            <span class="nav-text">card-content</span>
                            <span class="countercart">${cartCount}</span>
                        </span>
                    </a>
                </li>
                <li>
                    <a href="/profile/">
                        <span>
                            <i class="icon f7-icons">person</i>
                            <span class="nav-text">Profile</span>
                        </span>
                    </a>
                </li>
                <li>
                    <a href="/contactus/">
                        <span>
                            <i class="icon f7-icons">question_circle</i>
                            <span class="nav-text">Help</span>
                        </span>
                    </a>
                </li>
            </ul>
        </div>
    </footer>

    </div>
</template>
<script>
    export default (props, {
        $f7,
        $theme,
        $on,
        $update,
        $
    }) => {
        var app = $f7;
        let cartList = [];
        let item = {
            "address": "",
            "id": "",
            "landmark": "",
            "mobile": "",
            "name": "",
            "pin": "",
            "type": ""
        };
        let calendarModal;
        let totalQuantity = 0;
        let total = 0;
        let subtotal = 0;
        // let cartCount = app.params.cartCount();
        let cartCount = 0;
        let shippingCost = 0;
        const pageId = app.params.uuid();
        let type = "";
        let typeCode = "";
        let timeSchedule = [];
        let patientList = [];

        //prescription upload 
        let numberList = [];
        let prescriptionList = [];
        let savePrescription = [];
        
        //file upload 
        const openCamera = () => {
    
        var options = {
            // Some common settings are 20, 50, and 100
            quality: 75,
            destinationType: Camera.DestinationType.FILE_URI,
            // In this app, dynamically set the picture source, Camera or photo gallery
            sourceType: Camera.PictureSourceType.CAMERA,
            encodingType: Camera.EncodingType.JPEG,
            mediaType: Camera.MediaType.PICTURE,
            allowEdit: false,
            correctOrientation: true
        }
    
          navigator.camera.getPicture(function (imageURI) {
              console.log(imageURI);
              fileUpload(imageURI);
    
            }, function (message) {
              console.log('Failed because: ' + message);
            },
            options
          );
        }
    
        // const openGallery = () 
    
        const openGallery = () => {
    
          var options = {
            // Some common settings are 20, 50, and 100
            quality: 75,
            destinationType: Camera.DestinationType.FILE_URI,
            // In this app, dynamically set the picture source, Camera or photo gallery
            sourceType: Camera.PictureSourceType.PHOTOLIBRARY,
            encodingType: Camera.EncodingType.JPEG,
            mediaType: Camera.MediaType.PICTURE,
            allowEdit: false,
            correctOrientation: true
          }
    
          navigator.camera.getPicture(function (imageURI) {
              console.log(imageURI);
              fileUpload(imageURI);
    
            }, function (message) {
              console.log('Failed because: ' + message);
            },
            options
          );
        }
    
        const openSaveImage = () => {
    
          app.preloader.show();
          $('#selected_prescription_container_popup').html("");
          app.params.callToServer("save-prescription-list", "",
                      function success(Responce) {
                          $f7.preloader.hide();
                          //if successfully submited 
                          if(Responce.success){
    
                            savePrescription = Responce.data
                            $update();
                            app.popup.open(".saveImageList");
                          }
                      
                      });
          
        }
    
        const fileUpload = (imageURI) => {
          var progressValue = 0;
           //open progessbar ==   
           var dialog = $f7.dialog.progress('Uploading ... ', progressValue);
               dialog.setText(progressValue+'%');
    
          var options = new FileUploadOptions();
          options.fileKey = "image";
          options.fileName = imageURI.substr(imageURI.lastIndexOf('/') + 1);
          options.mimeType = "image/jpeg";
          options.headers = {
            Connection: "close"
          }
          options.chunkedMode = false;
    
          var params = {};
          //params.ipdid = ipdid;
          // params.oxyLabel = oxyLabel;
          options.params = params;
          var headers = {
            'Authorization': 'Bearer ' + localStorage.getItem("token"),
            'Accept': 'application/json'
          };
          options.headers = headers;
    
          var ft = new FileTransfer();
          //need to add header with user details 
          var url = app.params.remoteUrl + 'upload-prescription/';
          
         // handle progress bar 
          ft.onprogress = function (progressEvent) {
    
            if (progressEvent.lengthComputable) {
              // Calculate the percentage
             // console.log(progressEvent);
              progressValue = parseInt((progressEvent.loaded / progressEvent.total)*100);
            } else {
              progressValue++;
            }
    
            // Display percentage in the UI
            dialog.setProgress(progressValue);
            dialog.setText(progressValue+'%');
            console.log(progressValue);
            
          };
    
          //handle file upload 
          ft.upload(imageURI, url,
            function (result) {
              dialog.close();
              
              var data = JSON.parse(result.response);
              console.log(data);
    
              var imageURL = data.data.image;
              var prescritionID = data.data.id;
              var thumpURL = data.data.thumbnail;
    
              //apend image on prescription area 
              selectImage(prescritionID,thumpURL);
              calculateSelectedPrescrip_id();
    
            },
            function (error) {
              dialog.close();
              var data = JSON.parse(error.body);
    
              let toastBottom = app.toast.create({
                text: "data.",
                closeTimeout: 2000,
                });
                toastBottom.open();
              console.log(error);
              
            }, options);
    
        }
        
        const selectPrescription =(imageURI,imageId) =>{
            //apend image on prescription area 
            selectImage(imageId,imageURI);
            calculateSelectedPrescrip_id();
            app.popup.close(".saveImageList");
        }

         //show uploaded image 
        const selectImage = (imageId,imageUrl)=>{
        
            var selectedImage = '<div class="col-33">'+
            '                       <div class="text-align-center" >'+
            '                           <div style="display:none" class="prescripId" >'+imageId+'</div>'+
            '                           <img slot="media" src="'+imageUrl+'" width="75" alt=""/>'+
            '                       </div>'+
            '                   </div>';
    
            $('#selected_prescription_container').append(selectedImage);  
        }

        const calculateSelectedPrescrip_id = () => {
            prescriptionList = [];
            $('#prescriptionIdList').val("")
    
            let selectedButton = '#pageId_' + pageId + ' #selected_prescription_container .prescripId';
            $(selectedButton).each(function (e) {
            let nbr = $(this).text();
            prescriptionList.push(nbr);
            });
            console.log(prescriptionList);
            $('#prescriptionIdList').val(JSON.stringify(prescriptionList))
    
        }
    
        calendarModal = $f7.calendar.create({
            inputEl: '#calendar-modal',
            openIn: 'customModal',
            timePicker: false,
            // header: true,
            //footer: true,
            closeOnSelect: true,
            animate: true,
            // dateFormat: { month: 'numeric', day: 'numeric', year: 'numeric', hour: 'numeric', minute: 'numeric' },
            dateFormat: 'dd/mm/yyyy',
            on: {
                opened: function () {
                    console.log('Calendar opened')
                },
                closed: function () {
                   var date = calendarModal.getValue();
                    $('#calendar-modal').val(date);                                            
                   console.log(date )
               }
            }
        });
        
        const nextPayment = () => {

            var fordata = app.form.getFormData('#pageId_'+ pageId +'cart-address-form');
            console.log(fordata);
            //$f7.preloader.show();
            app.views.main.router.navigate('/payment/', {});
            //get for details //

            /*
            app.params.callToServer( "final-checkout",'', success);
            function success(ResponceData){
                $f7.preloader.hide();
              //  updateCurrentCart();
                //item = ResponceData.data.defaultAddress[0]; 
               // $update();
                app.views.main.router.navigate('/payment/', {
                    ignoreCache: true,
                    reloadCurrent: true,
                });
                app.views.main.router.clearPreviousHistory();
            } */


        }


        app.params.authHeader();

        let removeCurrentProduct = (pid) => {
            $f7.preloader.show();
            //=======remove cart items from server =======
            app.params.callToServer("remove-cart", {
                    'pid': pid
                },
                function success(Responce) {
                    $f7.preloader.hide();
                    updateCurrentCart(Responce);
                    // categoryName = Responce.data.category;
                });
        }

        const updateCurrentCart = (Responce) => {
            
           
            cartList = Responce.cartContent;
            totalQuantity = Responce.totalQuantity;
            total = Responce.total;
            subtotal = Responce.subtotal;
            cartCount = Responce.cartCount;
            shippingCost = Responce.shippingCost;
            type = Responce.type;
            typeCode = Responce.typeCode;
            
            console.log(typeCode,'typeCode');
            if (typeCode == 'labtest') {
                timeSchedule = Responce.timeSchedule;
                patientList = Responce.patientList;
            }
            if (typeCode == 'medicine') {
                patientList = Responce.patientList;
            }
          //  calendarModal.inputEl = "#calendar-modal";

            $update();
         

        }

        // === display Address selection button list ===
        $(document).on('change', "#pageId_" + pageId + " input[name='collection_type']", function (e) {
            let checkeedVal = $(this).val();
            if (checkeedVal == 'home') {
                $('#labAddressSelectBlock').show();

            } else {
                $('#labAddressSelectBlock').hide();

            }

        });

        $(document).on('submit','#pageId_'+ pageId +'cart-address-form',function(e){
            e.preventDefault();
            var fordata = app.form.getFormData('#pageId_'+ pageId +'cart-address-form');
            console.log(fordata);
            //$f7.preloader.show();
            app.views.main.router.navigate('/payment/', {});
        });


        $(document).on('click','#calendar-modal',function(e){
            //dateFormat.dateFormat('dd/mm/yyyy') ; 
            //calendarModal.open();
           
            
           // var calendar = app.calendar.create({
          //      inputEl: '#calendar-modal'
           // });
        });


        $on('pageInit', () => {

            var calendar = app.calendar.create({
                inputEl: '#calendar-modal',
                openIn: 'customModal',
                dateFormat: 'dd/mm/yyyy',
            });

            //cart count updation 
            app.params.callToServer('cart-count','',function (response) {
                if (response.success) {
                    cartCount =  response.data.cartCount;
                }
                $update();
            }); 


        });



        $on('pageBeforeIn', () => {
            $f7.preloader.show();
            app.params.callToServer("cart-address", '', success);

            function success(ResponceData) {
                $f7.preloader.hide();

                updateCurrentCart(ResponceData.data.cartDetails);
                if(ResponceData.data.defaultAddress[0] != null)
                    item = ResponceData.data.defaultAddress[0];
                //add some msg to display that address not added 

                $update();
            }



        });

        $on('pageBeforeRemove', () => {
            //calendarModal.destroy();
        });

        return $render;
    }
</script>