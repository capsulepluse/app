<template>
<div class="page page-track-order" id="pageId_${pageId}" data-name="track-order">
    <div class="navbar ">
        <div class="navbar-bg"></div>
        <div class="navbar-inner">
            <div class="left  no-margin-right">
                <a href="#" class="link icon-only back">
                    <i class="icon f7-icons size-22">arrow_left</i>
                </a>
            </div>
            <div class="title">
                <h5 class="no-margin-bottom">Track Orders</h5>
            </div>
            <div class="right text-align-center">
                <a href="/notificationlist/" class="link">
                    <i class="icon f7-icons size-22">bell_fill</i>
                </a>
            </div>
        </div>
    </div>


    <!-- main page content -->
    <div class="page-content ">

        <!-- Bills invoice  -->
        <div class="block margin-bottom-half">
            <div class="row">
                <div class="col-auto">
                    <p class="small text-muted">Order ID: ${order.invoice}</p>
                </div>
                <div class="col text-align-right">
                    <p class="small text-muted">${typeNme}</p>
                </div>
            </div>
        </div>

        <!-- Product tracking information -->
        <div class="block">
            <div class="row">
                <div class="col-100 medium-50 large-33 ">

                    <div class="card card-light elevation-2 margin-bottom-half ">
                        <div class="card-header">
                            <h5><p>Your order status</p></h5>
                        </div>
                        <div class="card-content card-content-padding">
                            <div class="timeline no-margin">
                                 ${trackDetails.map((item) => $h`
                                <div class="timeline-item">
                                    <div class="timeline-item-date">${item.date} <small>${item.month}</small></div>
                                    <div class="timeline-item-divider"></div>
                                    <div class="timeline-item-content">
                                        <div class="timeline-item-time">${item.time}</div>
                                        <div class="timeline-item-subtitle font-weight-bold">${item.status}</div>
                                        <div class="timeline-item-text">${item.comment}</div>
                                    </div>
                                </div>
                                `)}
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product price information -->
        <div class="block">
            <div class="row margin-bottom-half">
                <div class="col-100">
                    <h5><p>Order Details</p></h5>
                </div>
            </div>
        </div>

        <div class="block">
            <div class="row">
                <div class="col-100 medium-50 large-33 ">
                    <div class="card shadow-sm product margin-bottom">
                        <div class="card-content card-content-padding">
                            <div class="row">
                                
                                <div class="col padding-left align-self-center">
                                    <div class="row">
                                        <div class="col">
                                            
                                                ${type == 'labtest' && $h`
                                                    ${orderDetails.map((item) => $h`
                                                        <p class="font-12">${item.test_name}</p>
                                                    `)}
                                                `}


                                                ${type == 'medicine' && $h`
                                                    ${orderDetails.map((item) => $h`
                                                        <p  class="font-12">${item.items_name} <small class="text-opac">( Qnt: ${item.quantity})</small></p>
                                                    `)}
                                                `}

                                                ${type == 'product' && $h`
                                                    ${orderDetails.map((item) => $h`
                                                        <p  class="font-12">${item.items_name} <small class="text-opac">( Qnt: ${item.quantity})</small></p>
                                                    `)}
                                                `}
  
                                        </div> 
                                    </div>
                                    
                                </div>
                            </div>
                            
                        </div>
                        <div class="card-footer">
                            <div class="row">
                                <div class="col">
                                    <div class="text-color-theme">Total amount </div>
                                </div>
                                <div class="col-auto">
                                    <a href="#" class="link text-color-theme"> ₹ ${order.amount}</a>
                                </div>
                            </div>
                        </div>
                    </div>
                   
                </div>
            </div>
        </div>




        <!-- <div class="block">
            <div class="row margin-bottom">
                <div class="col-100 medium-50 large-33 margin-h-auto">
                    <p class="text-muted">Price <span class="float-right">₹ 1800.00</span></p>
                    <p class="text-muted">Discount <span class="float-right">-₹ 390.00</span></p>
                    <p class="text-muted margin-bottom-half">Shipping Charge <span class="float-right">₹ 20.00</span></p>
                    <h6>Total Amount <span class="float-right">₹ 1420.00</span></h6>
                </div>
            </div>
        </div> -->
        
        <!-- order footer -->
        <div class="block">
            <div class="row ">
                <div class="col-100 medium-50 large-33">
                    <!-- <p>We recommend power services for our customers</p>
                    <br />
                    <p class="text-align-right margin-top margin-bottom">
                        <i class="icon f7-icons size-32">signature</i><br/>
                        <span class="text-muted">Authorise Signature</span><br/>
                        Capsulepluse
                    </p> -->
                    
                    ${canCancel && $h`
                    <div class="row margin-bottom">    
                            <div class="col-100 margin-h-auto">
                                <button  @click="${()=>cancelOrder()}" class="button button-fill button-large button-raised bg-color-pink">
                                    <i class="f7-icons icon margin-right-half">cart</i>Cancel Order
                                </button>
                            </div>
                    </div>
                    `} 
                    <div class="row margin-bottom-half">
                        <div class="col-100 margin-h-auto">
                            <a href="/contactus/" class="button button-outline button-large ">
                                <i class="f7-icons icon margin-right-half">question_circle</i> Need Help?
                            </a>
                        </div>
                    </div>
                    ${type == 'labtest' && $h`  
                        ${canDownload && $h`  
                        <div class="row margin-bottom">    
                            <div class="col-100 margin-h-auto">
                                <a href="/home/" class="button button-fill button-large button-raised">
                                    <i class="f7-icons icon margin-right-half">cart</i>Download Report
                                </a>
                            </div>
                        </div>
                        `}   
                    `}   
                </div>
            </div>
        </div>

     
    </div>
</div>
</template>
<script>
    export default (props, { $f7, $theme, $on, $update, $ }) => {
        var app = $f7;
        let orderId = props.orderId;
        let type = props.type;
        let canCancel = false;
        let canDownload = false;
        let order =[];
        let orderDetails = [];
        let trackDetails = [];
        let typeNme = "";

        const pageId = app.params.uuid();

        const removeAddress = (addID) =>{
            $f7.preloader.show();
            app.params.callToServer( "remove-address",'{"id":"'+ addID+'"}', success);
            function success(Response){
              $f7.preloader.hide();
              app.params.showToastBottom(Response.message); 
              addressList = Response.data; 
              $update(); 
          }  

        }

        // cancel oder 
        let cancelOrder = ()=>{

              $f7.dialog.confirm('Do you want to cancel the order ? ','', function () {
                    $f7.preloader.show();
                    //=======remove cart items from server =======
                    app.params.callToServer( "order-cancel", {'product':orderId,'type':type } ,
                    function success(Response){
                        $f7.preloader.hide();
                        app.params.showToastBottom(Response.message);
                        app.views.main.router.back();
                    });        
                });



            /* $f7.preloader.show();
             //=======remove cart items from server =======
            app.params.callToServer( "remove-cart", {'pid':pid} ,
            function success(Responce){
                $f7.preloader.hide();
                updateCurrentCart(Responce);
                // categoryName = Responce.data.category;
            }); */
        }

        $on('pageInit', () => {
            /*
            $f7.preloader.show();
            app.params.callToServer("order-details", '{"type":"' + type + '","id":' + orderId + '}', success);
      
            function success(Responce) {
                $f7.preloader.hide();

                order = Responce.data.order;
                orderDetails = Responce.data.orderDetails;
                trackDetails = Responce.data.trackDetails;
                typeNme = Responce.data.typeName;
                type = Responce.data.type;
                $update();
            }
            */
      
        });
      



        $on('pageBeforeIn', () => {
            $f7.preloader.show();
            app.params.callToServer("order-details", '{"type":"' + type + '","id":' + orderId + '}', success);
      
            function success(Responce) {
                $f7.preloader.hide();

                order = Responce.data.order;
                orderDetails = Responce.data.orderDetails;
                trackDetails = Responce.data.trackDetails;
                typeNme = Responce.data.typeName;
                type = Responce.data.type;
                canCancel = Responce.data.canCancel;
                canDownload = Responce.data.canDownload;
                $update();
            }
        });
  
      return $render;
    }
</script>