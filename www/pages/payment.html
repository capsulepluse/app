<template>
<div class="page page-payment" data-name="payment">
    <div class="navbar ">
        <div class="navbar-bg"></div>
        <div class="navbar-inner">
            <div class="left  no-margin-right">
                <a href="#" class="link icon-only panel-open " data-panel="left">
                    <i class="icon f7-icons size-22">bars</i>
                </a>
            </div>
            <div class="title text-align-center">
                <div class="logo-small">
                    <img src="img/logo.png" alt="" class="img" /> 
                </div>
            </div>
            <div class="right text-align-center">
                <a href="/notificationlist/" class="link">
                    <i class="icon f7-icons size-22">bell_fill</i>
                </a>
            </div>
        </div>
    </div>


    <!-- main page content -->
    <div class="page-content has-footer top-compact">

        <!-- wizard links -->
        <div class="block">
            <div class="row justify-content-between wizard-wrapper margin-bottom-half elevation-2 ">
                <div class="col-33">
                    <a href="/cart/" class="wizard-link filled">
                        <i class="icons f7-icons elevation-2">bag</i>
                        <span class="wizard-text">${type}</span>
                    </a>
                </div>
                <div class="col-33">
                    <a href="/address/" class="wizard-link filled">
                        <i class="icons f7-icons elevation-2">placemark</i>
                        <span class="wizard-text">Address</span>
                    </a>
                </div>
                <div class="col-33">
                    <a href="/payment/" class="wizard-link active">
                        <i class="icons f7-icons elevation-2">creditcard</i>
                        <span class="wizard-text">Payment</span>
                    </a>
                </div>
            </div>
        </div>

        ${cartCount !=0 && $h`

        <!-- Apply coupon code -->
        <!-- <div class="block">
            <div class="row margin-bottom-half">
                <div class="col align-self-center">
                    <h5 class="no-margin-bottom">Coupon Code</h5>
                </div>
                <div class="col-auto pe-0 align-self-center">
                    <a href="/home/" class="link text-color-theme">Offers <i class="icons f7-icons">chevron_right</i></a>
                </div>
            </div>
        </div>
        <div class="block">
            <div class="row margin-bottom-half">
                <div class="col">
                    <div class="list form-list no-margin">
                        <ul>
                            <li class="item-content item-input">
                                <div class="item-inner">
                                    <div class="item-title item-floating-label">Coupon Code</div>
                                    <div class="item-input-wrap">
                                        <input type="text" name="couponcode" value="FREEDEL100" />
                                        <span class="input-clear-button"></span>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="alert alert-green margin-bottom " role="alert">
                <div class="row">
                    <div class="col-auto align-self-center">
                        <i class="icon f7-icons text-color-green size-32">checkmark_alt_circle</i>
                    </div>
                    <div class="col no-padding-left">
                        <h6 class="text-color-green margin-bottom-half">Congratulations!</h6>
                        <p class="text-opac small">You have successfully applied "FREEDEL100" free delivery
                            coupon and updated price total amount as per below</p>
                    </div>
                </div>
            </div>
        </div> -->
        <!-- end of coupon code  -->

        <!-- payments -->
        <div class="block">
            <div class="row margin-bottom-half">
                <div class="col align-self-center">
                    <h5 class="no-margin-bottom"><p>Payment Modes</p></h5>
                </div>
            </div>
        </div>

        <div class="block">
            <div class="row margin-bottom">
                <div class="col-100 medium-50 large-33">
                    <a href="#" class="card elevation-2 display-block margin-bottom-half product text-normal">
                        <div class="card-content card-content-padding">
                            <div class="row">
                                <div class="col-auto ">
                                    <label class="item-radio item-radio-icon-start item-content">
                                        <input type="radio" name="defaultAddress" value="" checked />
                                        <i class="icon icon-radio"></i>
                                    </label> 
                                </div>
                                <div class="col align-self-center">
                                    <!-- <p>Maestro card<br><small class="text-opac">**** **** **** 5689</small></p> -->
                                    <p>Cash on delivery</p>
                                </div>
                                <div class="col-auto align-self-center">
                                    <i class="icons f7-icons text-color-theme">chevron_right</i>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div> 

         <!-- pricing -->
         <div class="block">
            <div class="row margin-bottom-half">
                <div class="col align-self-center">
                    <h5 class="no-margin-bottom"><p>Pricing</p></h5>
                </div>
            </div>
            <div class="row margin-bottom-half ">
                <div class="col">
                    ${type == 'Lab test' && $h`
                    <p class="font-12">Sample Collection Charge</p>
                    `}
                    ${type != 'Lab test' && $h`
                    <p class="font-12">Shipping Cost</p>
                    `}
                </div>
                <div class="col-auto font-12">
                    ${shippingCost == 0 && $h`
                        Free
                    `}
                    ${shippingCost > 0 && $h`
                        ₹ ${shippingCost}
                    `}    
                   
                </div>
            </div>

            <div class="row margin-bottom-half font-12">
                <div class="col">
                    <p class="font-12">Subtotal</p>
                </div>
                <div class="col-auto font-12">₹ ${subtotal}</div>
            </div>

            <div class="row font-weight-bold margin-bottom">
                <div class="margin-bottom-half col-100">
                    <div class="dashed-line"></div>
                </div>
                <div class="col">
                    <p>Total</p>
                </div>
                <div class="col-auto">₹ ${total}</div>
            </div>
        </div>

        <!-- Button -->
        <div class="block">
            <div class="row margin-bottom">
                <div class="col align-self-center">
                        <button @click="${finalCheckout}" href="/thankyouorder/" class="button button-large button-fill elevation-3 color-green">Checkout</button>
                </div>
            </div>
        </div>

        `}

    </div>

    <!-- footer static -->
    <footer class="footer">
        <div class="container">
            <ul>
                <li>
                    <a href="/home/">
                        <span>
                            <i class="icon f7-icons">house</i>
                            <span class="nav-text">Home</span>
                        </span>
                    </a>
                </li>
                <li>
                    <a  href="/nearByLabList/">
                        <span>
                            <i class="icon f7-icons">eyedropper_halffull</i>
                            <span class="nav-text">Lab</span>
                        </span>
                    </a>
                </li>
                <li class="active center-item">
                    <a href="/cart/">
                        <span>
                            <i class="icon f7-icons">cart</i>
                            <span class="nav-text">card-content</span>
                            <span class="countercart">${cartCount}</span>
                        </span>
                    </a>
                </li>
                <li>
                    <a href="/profile/">
                        <span>
                            <i class="icon f7-icons">person</i>
                            <span class="nav-text">Profile</span>
                        </span>
                    </a>
                </li>
                <li>
                    <a href="/contactus/">
                        <span>
                            <i class="icon f7-icons">question_circle</i>
                            <span class="nav-text">Help</span>
                        </span>
                    </a>
                </li>
            </ul>
        </div>
    </footer>

</div>
</template>
<script>
    export default (props, { $f7, $theme, $on, $update, $ }) => {
      var app = $f7;
      let cartList = [] ;
      let item = {
        "address": "",
        "id":"",
        "landmark": "",
        "mobile": "",
        "name": "",
        "pin": "",
        "type": ""
      };  
        let totalQuantity =  0;
        let total = 0;
        let subtotal = 0;

        let cartCount = 0;
        let shippingCost = 0;
        const pageId = app.params.uuid();
        let type="Medicine";

        const finalCheckout = ()=>{
            $f7.preloader.show();
            var fordata  = app.form.getFormData("#cart-address-form");
            console.log(fordata);
            //get for details //


            app.params.callToServer( "final-checkout",fordata, success);
            function success(ResponceData){
                $f7.preloader.hide();
              //  updateCurrentCart();
                //item = ResponceData.data.defaultAddress[0]; 
               // $update();
                app.views.main.router.navigate('/thankyouorder/', {
                    ignoreCache: true,
                    reloadCurrent: true,
                });
                app.views.main.router.clearPreviousHistory();
            }
        }
       

        const updateCurrentCart = (Responce)=>{
                cartList = Responce.cartContent ;
                totalQuantity = Responce.totalQuantity;
                total = Responce.total;
                subtotal = Responce.subtotal;
                cartCount = Responce.cartCount;
                shippingCost =  Responce.shippingCost;
                type = Responce.type;
                $update();
        }

        $on('pageInit', () => {
            $f7.preloader.show();
            app.params.callToServer( "cart-payment",'', success);
            function success(ResponceData){
                $f7.preloader.hide();
                updateCurrentCart(ResponceData.data.cartDetails);
                //item = ResponceData.data.defaultAddress[0];
                $update();
            }

             //cart count updation 
             app.params.callToServer('cart-count','',function (response) {
                if (response.success) {
                    cartCount =  response.data.cartCount;
                }
                $update();
            }); 




        });
  
      return $render;
    }
  </script>