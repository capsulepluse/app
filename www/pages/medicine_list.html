<template>
  <div class="page page-product_list" id="pageId_${pageId}" data-name="medicine_list">
    <div class="navbar ">
      <div class="navbar-bg"></div>
      <div class="navbar-inner">
        <div class="left  no-margin-right">
          <a href="#" class="link icon-only back">
            <i class="icon f7-icons size-22">arrow_left</i>
          </a>
        </div>
        <div class="title text-align-center">
          <div class="logo-small">
            <img src="img/logo.png" alt="" class="img" />
            <!-- <h6>Capsule +<br /><small></small></h6> -->
          </div>
        </div>
        <div class="right text-align-center">
          <a href="/notificationlist/" class="link">
            <i class="icon f7-icons size-22">bell_fill</i>
          </a>
        </div>
      </div>
    </div>

   

    <div class="page-content has-footer">
      <!-- main page content -->
      <div class="main-container container">

        <!-- search -->
        <div class="block">


          <!-- <div class="searchbar">
            <div class="searchbar-inner">
              <div class="searchbar-input-wrap">
                <input type="search" placeholder="Search"/>
              
                <i class="searchbar-icon"></i>
                <span class="input-clear-button"></span>
              </div>
              <span class="searchbar-disable-button">Cancel</span>
            </div>
          </div>
          
          <div class="search-results"></div> -->



          
          <div class="row margin-bottom-half">
            <div class="col no-padding-right_">
              <div class="list form-list no-margin">
                <ul>
                  <li class="item-content item-input">
                    <div class="item-inner no-padding-top no-padding-buttom">
                      
                      <div class="item-input-wrap">
                        <input type="text" name="search" placeholder="Search Medicine " class="search-input padding-top-half" />
                        <i class="icon material-icons md-only">search</i>
                        <span class="input-clear-button"></span>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
            <!-- <div class="col-auto padding-left-half">
              <button class="button button-fill button-small padding elevation-3 searchbtn" >
                <i class="icon f7-icons">search</i>
              </button>
            </div> -->
          </div>

        </div>


         <!-- slides 1 -->
         <div class="block  skeleton-text skeleton-effect-wave placeHolderOut">
          <div class=" ">
            <div class="card-content  ">
              <div class=" rounded skeleton-block " style=" height: 150px; width:100%; "></div>
            </div>
        
          </div>
        </div>
        
        <div class="block">
          <div class="swipe swiper-container labtest_slider_1 margin-bottom-mini " data-loop_="false">
            <div class="swiper-wrapper">
        
            </div>
          </div>
        </div>
        <!-- end  -->





         <!-- Quick List -->
         <div class="block">
          <div class="row">
              <div class="col-100 ">
                  <div class="card elevation-2 margin-bottom-half">
                      <div class="mediaList customeList list searchbar-found">
                          <ul>
                             
                            ${product.map((item) => $h`

                              <li class="item">
                                  <!-- <a class="item-link_" href="#"> -->
                                      <div class="item-content">
                                          <div class="item-media">
                                              <img slot="media" src="${item.img}" width="44"
                                                  alt="" />
                                          </div>
                                          <div class="item-inner item-cell">

                                              <div class="col-100 item-title_ font-16">
                                                  <a  href="/medicine/${item.id}/" >  
                                                    <div class="text-color-black">${item.name}</div> 
                                                  </a>
                                              </div>

                                              <div class="col-100 text-color-black">
                                                    <small class="font-10 text-opac manufactire line-height-20">${item.manufacturer}</small>
                                              </div>

                                              <div class="col item-row ">
                                                  <div class="col item-footer text-color-black mrp-text ">
                                                      <div class="col item-row">
                                                        <small class="font-11">MRP</small>:<small class=" item-cell text-opac font-11" style="text-decoration: line-through;"> ₹ ${item.MRP}</small>
                                                      </div>
                                                      <div class="item-row font-16 "> ₹ ${item.saleprice} </div>
                                                  </div> 
                                                  <div class="col-auto middle-button font-10">
                                                    <span 
                                                    class="button button-small button-outline font-10 medicine_add_to_cart
                                                    ${item.isCartQnt > 0 && $h`
                                                      display-none
                                                      `} 
                                                    "
                                                    data-pid="${item.id}" 
                                                    data-quantity="1"
                                                    data-type="${type}"
                                                     >Add</span>
    
                                                       <!-- Stepper element -->
                                                    <!-- <div class="stepper">
                                                      <div class="stepper-button-minus counter-decrease"></div>
                                                      <div class="stepper-value counter-value">1</div>
                                                      <div class="stepper-button-plus counter-increase"></div>
                                                    </div> -->
    
                                                     <!-- button counter increamenter-->
                                                    <div class="counter-number
    
                                                      ${item.isCartQnt == 0 && $h`
                                                       display-none
                                                       `} 
                                                      ">
                                                      <button class="btn avatar avatar-30 no-padding rounded-circle counter-decrease"
                                                      data-pid="${item.id}" 
                                                      data-type="${type}"
                                                      >
                                                          <i class="icons f7-icons">minus</i>
                                                      </button>
    
                                                      ${item.isCartQnt > 0 && $h`
                                                        <span class="counter-value font-13">${item.isCartQnt}</span>
                                                      `}
                                                      ${item.isCartQnt == 0 && $h`
                                                        <span class="counter-value font-13">1</span>
                                                      `}
                                                     
    
    
                                                      <button class="btn avatar avatar-30 no-padding rounded-circle  counter-increase"
                                                      data-pid="${item.id}" 
                                                      data-type="${type}"
                                                      
                                                      >
                                                          <i class="icons f7-icons">plus</i>
                                                      </button>
                                                    </div>
    
    
    
                                                  </div>    
                                              </div> 

                                               
                                          </div>
                                         
                                      </div>
                                  <!-- </a> -->
                              </li>
                            `)}  


                          </ul>
                      </div>
                  </div>
              </div>
          </div>
         </div>

            <!-- slides 2  -->
            <div  class="block  skeleton-text skeleton-effect-wave placeHolderOut">
              <div class=" " >
                  <div class="card-content  ">
                      <div class=" rounded skeleton-block " style=" height: 150px; width:100%; "></div>
                     
                  </div>
                 
              </div>
            </div>
         
          <div class="block" >
              <div class="swipe swiper-container labtest_slider_2 margin-bottom-mini "   data-loop_="false">
                  <div class="swiper-wrapper">
  
                  </div>
                 
              </div>
          </div>
          <!-- end  -->


      </div>
      <!-- main page content ends -->

    </div>

    <!-- footer static -->
    <footer class="footer">
      <div class="container">
          <ul>
              <li>
                  <a class="active" href="/home/">
                      <span>
                          <i class="icon f7-icons">house</i>
                          <span class="nav-text">Home</span>
                      </span>
                  </a>
              </li>
              <li>
                  <a  href="/nearByLabList/">
                      <span>
                          <i class="icon f7-icons">eyedropper_halffull</i>
                          <span class="nav-text">Lab</span>
                      </span>
                  </a>
              </li>
              <li class="center-item">
                  <a href="/cart/">
                      <span>
                          <i class="icon f7-icons">cart</i>
                          <span class="nav-text">card-content</span>
                          <span class="countercart">${cartCount}</span>
                      </span>
                  </a>
              </li>
              <li>
                  <a href="/profile/">
                      <span>
                          <i class="icon f7-icons">person</i>
                          <span class="nav-text">Profile</span>
                      </span>
                  </a>
              </li>
              <li>
                  <a href="/contactus/">
                      <span>
                          <i class="icon f7-icons">question_circle</i>
                          <span class="nav-text">Help</span>
                      </span>
                  </a>
              </li>
          </ul>
      </div>
  </footer>



  </div>
</template>
<script>
  export default (props, {
    $f7,
    $theme,
    $on,
    $update,
    $
  }) => {
    var app = $f7;
    let product = [];
    let categoryName = "";
    let type = "medicine";
    let value = "";
    let cartCount = 0;
    let productDetails = {
      price: "",
      image: "",
      mrp: "",
      name: "",
      pid: "",
      type: ""
    };
    const pageId = app.params.uuid();
    let slider_1 = [];
    let slider_2 = [];
    let medical = [];

//    let autocompleteDropdownTypeahead;
//    let autocompleteDropdownAjaxTypeahead;


    $(document).on('click', '#pageId_' + pageId + ' .medicine_add_to_cart', function (e) {

      productDetails = $(this).dataset();
      console.log(productDetails);
      $f7.preloader.show();
      
      //show counter and hide the add button 
      $(this).addClass("display-none");
      $(this).parent().find(".counter-number").removeClass("display-none");

      const addingCartOnLive = app.params.callToServer("add-cart-single", productDetails,
      function success(Responce) {
        $f7.preloader.hide();

        let toastBottom = app.toast.create({
          text: "Medicine has been added successfully !! ",
          closeTimeout: 2000,
          });

        toastBottom.open();

        cartCount = Responce.data.cartCount;
        $update();
      });
    })

    $(document).on('click',  '#pageId_' + pageId +' .counter-increase', function (e) {
      var countValue = parseInt($(this).parent().find(".counter-value").text());
      countValue = countValue + 1;
      $(this).parent().find(".counter-value").text(countValue);
      app.params.currentProductDetails.quantity = countValue;

      //update on cart
      productDetails = $(this).dataset();
      productDetails.quantity = countValue;
      app.preloader.show();
      app.params.callToServer("update-cart", productDetails,
      function success(Responce) {
        app.preloader.hide();
      });
    });

    $(document).on('click',  '#pageId_' + pageId +' .counter-decrease', function (e) {
      var countValue = parseInt($(this).parent().find(".counter-value").text());
      countValue = countValue - 1;

       //update on cart
      productDetails = $(this).dataset();
      productDetails.quantity = countValue;
      app.preloader.show();
      app.params.callToServer("update-cart", productDetails,
      function success(Responce) {
        app.preloader.hide();
      });

      if (countValue > 0) {
        $(this).parent().find(".counter-value").text(countValue);
        app.params.currentProductDetails.quantity = countValue;
      }else{ // show add button and hide counter 
          //show counter and hide the add button 
        $(this).parent().addClass("display-none");
        $(this).parent().parent().find(".medicine_add_to_cart").removeClass("display-none");

      }
    
    });

    

    $(document).on('click', '#pageId_' + pageId + ' .searchbtn', function (e) {
        var serchValue = $('#pageId_' + pageId + ' .search-input').val();
        $f7.preloader.show();
        app.params.callToServer( "medicine-search",'{"name":"'+serchValue+'"}',success);
        function success(Responce){
              $f7.preloader.hide();
              product = Responce.data ;
              //categoryName = Responce.data.category;
              $update();
          }
    })
    $(document).on('keyup', '#pageId_' + pageId + ' .search-input', function (e) {
        var serchValue = $('#pageId_' + pageId + ' .search-input').val();
        $f7.preloader.show();
        app.params.callToServer( "medicine-search",'{"name":"'+serchValue+'"}',success);
        function success(Responce){
              $f7.preloader.hide();
              product = Responce.data ;
              //categoryName = Responce.data.category;
              $update();
          }
    })

    function performAjaxSearch(query) {
      // Perform AJAX request to fetch search results
      // You can use Framework7's built-in AJAX methods or any other AJAX library (e.g., Axios, jQuery.ajax)
    
      // Example using Framework7's AJAX method
      console.log(query);
      app.params.callToServer( "medicine-search",'{"name":"'+query+'"}',success);
        function success(Responce){

          var searchResults = $('.search-results');
          searchResults.empty();
          //searchResults.html(data);

              $f7.preloader.hide();
              product = Responce.data ;
              //categoryName = Responce.data.category;
              $update();
          }




      /*-- app.request.get('/search-api', { query: query }, function (data) {
        // Handle the response and update the search results container
        var searchResults = $('.search-results');
        searchResults.empty();
        searchResults.html(data);
      }); */
    }


    $on('pageInit', () => {

      var searchbar = app.searchbar.create({
        el: '.searchbar',
        searchContainer: '.search-results',
        searchIn: '.item-title',
        on: {
          search(sb, query, previousQuery) {
            // Perform AJAX search request and update search results
            performAjaxSearch(query);
          },
          clear(sb, previousQuery) {
            // Clear search results
            $('.search-results').empty();
          },
        },
      });

      
      $f7.preloader.show();

      app.params.callToServer("medical-list", "", success);

      function success(Response) {
        $f7.preloader.hide();
        $('.placeHolderOut').hide();

        product = Response.data.medicine;
        slider_1 = Response.data.slider_1;
        slider_2 = Response.data.slider_2;
        $update();

        slider_1.forEach(setslider_1);
        swiper_1.autoplay.start();
        swiper_1.pagination.init();

        slider_2.forEach(setslider_2);
        swiper_2.autoplay.start();
        swiper_2.pagination.init();



      }
      


      /*
       $f7.preloader.show();
      app.params.callToServer( "product-list",'{"type":"'+ type+'","value":'+value+'}',success);
      function success(Responce){
            $f7.preloader.hide();
            product = Responce.data.product ;
            categoryName = Responce.data.category;
            $update();
        }
        */
         //cart count updation 
        app.params.callToServer('cart-count','', function (response) {
          if (response.success) {
              cartCount =  response.data.cartCount;
          }
          $update();
        }); 

        //slider details 
      const swiper_1 = new Swiper(".labtest_slider_1", {
        slidesPerView: "1",
        spaceBetween: 10,
      /*  pagination: {
            el: ".pagination-offerslides-home",
        }, */
        breakpoints: {
            640: {
                slidesPerView: 1,
            },
            768: {
                slidesPerView: 2,
                spaceBetween: 20,
            },
            1024: {
                slidesPerView: 3,
                spaceBetween: 30,
            },
        },
    });

      const swiper_2 = new Swiper(".labtest_slider_2", {
        slidesPerView: "1",
        spaceBetween: 10,
      /*  pagination: {
            el: ".pagination-offerslides-home",
        }, */
        breakpoints: {
            640: {
                slidesPerView: 1,
            },
            768: {
                slidesPerView: 2,
                spaceBetween: 20,
            },
            1024: {
                slidesPerView: 3,
                spaceBetween: 30,
            },
        },
    });



      const setslider_1 = (items, key) => {

            let slideritems = '' +
            '                             <div class="swiper-slide">' +
            '                                <div class="card  elevation-2 card-theme">' +
            '                                    <div class="card-content ">' +
            '                                        <div class="row">' +
            '                                            <div class="col-100 thum-parent">' +
            '                                            <img src="' + items.img +
            '                                                  " alt="" class="mw-100 thum-child" style="height:150px;width: 100%;" />' +
            '                                            </div>' +
            '                                            </div>' +
            '                                        </div>' +
            '                                    </div>' +
            '                                </div>  ' +
            '                            </div> ' +
            '';


            swiper_1.addSlide(key, slideritems);
      }

      const setslider_2 = (items, key) => {

        let slideritems = '' +
        '                             <div class="swiper-slide">' +
        '                                <div class="card  elevation-2 card-theme">' +
        '                                    <div class="card-content ">' +
        '                                        <div class="row">' +
        '                                            <div class="col-100 thum-parent">' +
        '                                            <img src="' + items.img +
        '                                                  " alt="" class="mw-100 thum-child" style="height:150px;width: 100%;" />' +
        '                                            </div>' +
        '                                            </div>' +
        '                                        </div>' +
        '                                    </div>' +
        '                                </div>  ' +
        '                            </div> ' +
        '';


        swiper_2.addSlide(key, slideritems);
      }







    });

    $on('pageBeforeRemove', () => {

    })

    return $render;
  }
</script>