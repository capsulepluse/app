<template>
  <div class="page page-product_list" id="pageId_${pageId}" data-name="medicine_list">
    <div class="navbar ">
      <div class="navbar-bg"></div>
      <div class="navbar-inner">
        <div class="left  no-margin-right">
          <a href="#" class="link icon-only back">
            <i class="icon f7-icons size-22">arrow_left</i>
          </a>
        </div>
        <div class="title text-align-center">
          <div class="logo-small">
            <img src="img/logo.png" alt="" class="img" />
            <!-- <h6>Capsule +<br /><small></small></h6> -->
          </div>
        </div>
        <div class="right text-align-center">
          <a href="/notificationlist/" class="link">
            <i class="icon f7-icons size-22">bell_fill</i>
          </a>
        </div>
      </div>
    </div>

    <!-- Filter nested panel -->
    <div class="panel panel-right panel-cover panel-init elevation-3" id="panel-right-filter"
      data-container-el="#panel-page" data-backdrop="false">
      <div class="page">
        <div class="page-content">
          <div class="block bg-white-opac margin-bottom padding-top padding-bottom">
            <div class="row">
              <div class="col">
                <h6 class="no-margin-bottom">Filter Criteria</h6>
                <p class="small text-muted">2154 products</p>
              </div>
              <div class="col-auto align-self-center">
                <button class="button panel-close no-padding">
                  <i class="icon f7-icons size-18">multiply</i>
                </button>
              </div>
            </div>
          </div>

          <div class="block">
            <div class="margin-bottom">
              <h6>Select Range</h6>
              <div id="rangeslider" class="margin-top"></div>
            </div>

            <div class="row margin-bottom">
              <div class="col">
                <label for="input-number" class="small text-muted">Minimum</label>
                <input type="number" min="0" max="500" value="100" step="1" id="input-select" />
              </div>
              <div class="col-auto align-self-center">
                <label class="small"></label>
                to
              </div>
              <div class="col">
                <label for="input-number" class="small text-muted">Maximum</label>
                <input type="number" class="form-control" min="0" max="500" value="200" step="1" id="input-number" />
              </div>
            </div>

            <div class="margin-bottom">
              <label for="filtertype" class="small text-muted">Select Shopping Type</label>
              <div class="card shadow-none">
                <div class="list">
                  <ul class="no-background">
                    <li>
                      <label class="item-checkbox item-content">
                        <input type="checkbox" name="demo-checkbox" value="Books" checked="men" />
                        <i class="icon icon-checkbox"></i>
                        <div class="item-inner">
                          <div class="item-title">Men</div>
                        </div>
                      </label>
                    </li>
                    <li>
                      <label class="item-checkbox item-content">
                        <input type="checkbox" name="demo-checkbox" value="women" />
                        <i class="icon icon-checkbox"></i>
                        <div class="item-inner">
                          <div class="item-title">Women</div>
                        </div>
                      </label>
                    </li>
                    <li>
                      <label class="item-checkbox item-content">
                        <input type="checkbox" name="demo-checkbox" value="kids" />
                        <i class="icon icon-checkbox"></i>
                        <div class="item-inner">
                          <div class="item-title">Kids</div>
                        </div>
                      </label>
                    </li>
                    <li>
                      <label class="item-checkbox item-content">
                        <input type="checkbox" name="demo-checkbox" value="home" />
                        <i class="icon icon-checkbox"></i>
                        <div class="item-inner">
                          <div class="item-title">Home</div>
                        </div>
                      </label>
                    </li>
                  </ul>
                </div>
              </div>
            </div>


            <div class="margin-bottom">
              <label for="input-select" class="small text-muted">Keyword</label>
              <input type="text" class="form-control" placeholder="Keyword" />
            </div>

            <div class="margin-bottom">
              <label for="discount" class="small text-muted">Offer Discount</label>
              <select class="form-control" id="discount">
                <option>10% </option>
                <option>30%</option>
                <option>50%</option>
                <option>80%</option>
              </select>
            </div>
          </div>

          <div class="block margin-bottom">
            <button class="button button-fill button-raised button-large">Apply</button>
          </div>
        </div>
      </div>
    </div>


    <div class="page-content has-footer">
      <!-- main page content -->
      <div class="main-container container">

        <!-- search -->
        <div class="block">
          <div class="row margin-bottom">
            <div class="col">
              <div class="list form-list no-margin">
                <ul>
                  <li class="item-content item-input">
                    <div class="item-inner">
                      <div class="item-title item-floating-label">Search</div>
                      <div class="item-input-wrap">
                        <input type="text" name="search" class="search-input" />
                        <span class="input-clear-button"></span>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
            <div class="col-auto">
              <button class="button button-fill button-large padding elevation-3 searchbtn" >
                <i class="icon f7-icons">search</i>
              </button>
            </div>
          </div>
        </div>



        <!-- Products -->
        <div class="block">
          <div class="row margin-bottom-half">
            <div class="col">
              <h5 class="no-margin-bottom">${categoryName}</h5>
            </div>
            <!-- <div class="col-auto">
              <a href="" class="link text-color-theme">View All <i class="icons f7-icons">chevron_right</i></a>
            </div> -->
          </div>
        </div>

        <div class="block">
          <div class="row">

            ${product.map((item) => $h`

            <div class="col-50 medium-33 large-25">
              <div class="card elevation-2 product margin-bottom">
                <div class="card-content card-content-padding">
                  <figure class="text-align-center">
                    <img src="${item.img}" alt="" />
                  </figure>
                  

                  <a href="/medicine/${item.id}/" class="text-normal margin-bottom-half display-block">
                    <h6 class="text-color-theme">${item.name}</h6>
                  </a>
                  <p class="">
                    <small class="text-opac">${item.manufacturer}</small>
                    <!-- <small class="float-right"><span class="text-opac">4.5</span> <i
                        class="icons f7-icons text-color-yellow">star</i></small> -->
                  </p>
                  <div class="row">
                    <div class="col">
                      <p class="no-margin-bottom">
                        <small>MRP</small> : <small class="text-opac" style="text-decoration: line-through;">₹
                          ${item.MRP}</small><br />
                        ₹ ${item.saleprice}
                      </p>
                    </div>
                    <div class="col-auto no-padding-left">
                      <button
                        class="button avatar avatar-40 no-padding rounded-circle elevation-3 button-gradient  add-to-card-button"
                        data-pid="${item.id}" data-mrp="${item.MRP}" data-price="${item.saleprice}"
                        data-name="${item.name}" data-image="${item.img}" data-type="${type}">
                        <i class="icons f7-icons">plus</i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            `)}

          </div>
        </div>



        <!-- add product popup-->
        <div class="popup addproduct">
          <div class="view">
            <div class="page">
              <div class="navbar">
                <div class="navbar-bg"></div>
                <div class="navbar-inner">
                  <div class="left">
                    <a class="link popup-close"><i class="icons f7-icons">arrow_left</i></a>
                  </div>
                  <div class="title">Add to Cart</div>
                  <div class="right">
                    <!-- Link to close popup -->
                    <a class="link popup-close"><i class="icons f7-icons">multiply</i></a>
                  </div>
                </div>
              </div>
              <div class="page-content">
                <div class="block margin-bottom">
                  <figure class="text-center padding">
                    <img src="${productDetails.image}" alt="" class="mw-100" />
                  </figure>
                </div>
                <div class="block margin-bottom">
                  <!-- <p class="margin-bottom-half">
                    <small class="text-opac">Fresh</small>
                    <small class="float-end"><span class="text-opac">4.5</span> <i
                        class="bi bi-star-fill text-warning"></i></small>
                  </p> -->
                  <a href="#" class="text-normal display-block margin-bottom-half">
                    <h6 class="text-color-theme">${productDetails.name}</h6>
                  </a>
                  <div class="row">
                    <div class="col">
                      <p class="no-margin-bottom">
                        <small>MRP</small> : <small class="text-opac" style="text-decoration: line-through;">₹
                          ${productDetails.mrp}</small><br />
                        ₹ ${productDetails.price}
                      </p>
                    </div>
                    <div class="col-auto">
                      <!-- Stepper element -->
                      <div class="stepper">
                        <div class="stepper-button-minus counter-decrease"></div>
                        <!-- Stepper value element -->
                        <div class="stepper-value counter-value">1</div>
                        <div class="stepper-button-plus counter-increase"></div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="block">
                  <button @click="${app.params.addToCartCurrentProduct}" type="button"
                    class="button button-large button-fill color-green elevation-3 adding-cart"
                    data-pid="${productDetails.pid}">Add to Cart
                    <i class="icons f7-icons">arrow_right</i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>


      </div>
      <!-- main page content ends -->

    </div>

    <!-- footer static -->
    <footer class="footer">
      <div class="container">
        <ul>
          <li>
            <a class="active" href="/home/">
              <span>
                <i class="icon f7-icons">house</i>
                <span class="nav-text">Home</span>
              </span>
            </a>
          </li>
          <li>
            <a href="/stats/">
              <span>
                <i class="icon f7-icons">chart_bar</i>
                <span class="nav-text">Stats</span>
              </span>
            </a>
          </li>
          <li class="center-item">
            <a href="/cart/">
              <span>
                <i class="icon f7-icons">cart</i>
                <span class="nav-text">card-content</span>
                <span class="countercart">3</span>
              </span>
            </a>
          </li>
          <li>
            <a href="/style/">
              <span>
                <i class="icon f7-icons">circle_grid_hex</i>
                <span class="nav-text">Style</span>
              </span>
            </a>
          </li>
          <li>
            <a href="/settings/">
              <span>
                <i class="icon f7-icons">gear</i>
                <span class="nav-text">Settings</span>
              </span>
            </a>
          </li>
        </ul>
      </div>
    </footer>



  </div>
</template>
<script>
  export default (props, {
    $f7,
    $theme,
    $on,
    $update,
    $
  }) => {
    var app = $f7;
    let product = [];
    let categoryName = "";
    let type = "medicine";
    let value = "";
    let productDetails = {
      price: "",
      image: "",
      mrp: "",
      name: "",
      pid: "",
      type: ""
    };
    const pageId = app.params.uuid();

//    let autocompleteDropdownTypeahead;
//    let autocompleteDropdownAjaxTypeahead;



    $(document).on('click', '#pageId_' + pageId + ' .add-to-card-button', function (e) {
      console.log(productDetails);
      productDetails = $(this).dataset();
      //console.log(productDetails);
      app.params.setActiveProduct(productDetails);
      $update();
      app.popup.open('.addproduct');
    })

    $(document).on('click', '.adding-cart_', function (e) {
      //console.log('adding clicked');
      //let pid = $(this).data('pid'); 
      let countValue = parseInt($(this).parent().parent().find(".counter-value").text());

      var currentProduct = {
        price: productDetails.discount,
        image: productDetails.imageurl,
        mrp: productDetails.mrp,
        name: productDetails.name,
        pid: productDetails.pid,
        quantity: countValue
      }

      // console.log(currentProduct);

      //======= cart value from server =======
      const addingCartOnLive = app.params.callToServer("add-cart", currentProduct,
        function success(Responce) {
          $f7.preloader.hide();
          cartCount = Responce.data.cartCount;
          localStorage.setItem("cartCount", cartCount);
          // categoryName = Responce.data.category;
          $update();
        });

      app.popup.close('.addproduct');
    })


    $(document).on('click', '#pageId_' + pageId + ' .searchbtn', function (e) {
        var serchValue = $('#pageId_' + pageId + ' .search-input').val();
        $f7.preloader.show();
        app.params.callToServer( "medicine-search",'{"name":"'+serchValue+'"}',success);
        function success(Responce){
              $f7.preloader.hide();
              product = Responce.data ;
              //categoryName = Responce.data.category;
              $update();
          }
    })



    $on('pageInit', () => {


      /*
       $f7.preloader.show();
      app.params.callToServer( "product-list",'{"type":"'+ type+'","value":'+value+'}',success);
      function success(Responce){
            $f7.preloader.hide();
            product = Responce.data.product ;
            categoryName = Responce.data.category;
            $update();
        }
        */


    });

    $on('pageBeforeRemove', () => {

    })

    return $render;
  }
</script>